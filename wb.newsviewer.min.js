/*
 * jQuery News Viewer Plugin for WYSIWYG Web Builder 11
 * Copyright Pablo Software solutions 2016
 * http://www.wysiwygwebbuilder.com/
 */
(function(d){function l(d){return 10>d?"0"+d:d}function k(f,a,c,b,m,h){a=d("<a></a>").attr("href",a).attr("target",h.target).html(c);a=d("<h4></h4>").append(a);if(h.includeDate){c=new Date(b);if("twitter"==h.dateFormat)b=parseInt(((new Date).getTime()-c.getTime())/1E3),b=60>b?"less than a minute ago":120>b?"about a minute ago":3600>b?parseInt(b/60).toString()+" minutes ago":7200>b?"about an hour ago":86400>b?"about "+parseInt(b/3600).toString()+" hours ago":172800>b?"1 day ago":parseInt(b/86400).toString()+
" days ago";else{var n="January February March April May June July August September October November December".split(" "),r="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),e=c.getFullYear(),p=e.toString().substring(2),s=c.getMonth()+1,w=c.getDate(),k=c.getHours(),g=c.getMinutes(),q=c.getSeconds();b=h.dateFormat;b=b.replace("hh",l(k));b=b.replace("h",k);b=b.replace("nn",l(g));b=b.replace("n",g);b=b.replace("ss",l(q));b=b.replace("s",q);b=b.replace("yy",e);b=b.replace("y",p);b=
b.replace("mm",l(s));b=b.replace("m",s);b=b.replace("dd",l(w));b=b.replace("d",w);b=b.replace("DD","X1");b=b.replace("D","X2");b=b.replace("MM","X3");b=b.replace("M","X4");b=b.replace("X1",r[c.getDay()]);b=b.replace("X2",r[c.getDay()].substring(0,2));b=b.replace("X3",n[s-1]);b=b.replace("X4",n[s-1].substring(0,3))}b=d("<div></div>").addClass("publication-date").text(b)}else b=d("<div></div>");m=d("<div></div>").addClass("summary").html(m);a=d("<div></div>").addClass("headline").append(a,b,m,"");1>=
h.animation&&"rotate"==h.mode&&a.css({opacity:0});0==h.sortOrder?a.appendTo(f):a.prependTo(f)}function g(f,a){var c="#"+f.attr("id")+" .headline";if("default"==a.mode)f.css("overflow-y","auto"),d(c).css("position","relative"),d(c).css("height","auto"),d(c).css("top","0");else if("rotate"==a.mode){var b=0,m=0,h=0,n=f.css("padding-left");if(0==a.animation||1==a.animation)d(c).eq(b).css({opacity:1});else if(2==a.animation||3==a.animation)h="100%",3==a.animation&&(h="-100%"),d(c).css("left",h),d(c).eq(b).css("left",
n);else if(4==a.animation||5==a.animation)d(c).eq(b).css("top",n),h="100%",5==a.animation&&(h="-100%");var r=d(c).length,e,p=!1,k={},g={},l=function(){if(!p){p=!0;e=!1;b=(m+1)%r;if(0==a.animation||1==a.animation)k={opacity:0},g={opacity:1};else if(2==a.animation||3==a.animation)k={left:"100%"==h?"-100%":"100%"},g={left:n};else if(4==a.animation||5==a.animation)k={top:"100%"==h?"-100%":"100%"},g={top:n};d(c).eq(m).animate(k,a.animationDuration,function(){2==a.animation||3==a.animation?d(this).css("left",
h):4!=a.animation&&5!=a.animation||d(this).css("top",h)});d(c).eq(b).animate(g,a.animationDuration,function(){p=!1;e||(e=setTimeout(l,a.pause))});m=b}};e||(e=setTimeout(l,a.pause));f.hover(function(){clearTimeout(e);e=!1},function(){e||(e=setTimeout(l,250))})}else if("scroller"==a.mode)d(c).css("position","relative"),d(c).css("height","auto"),d(c).css("top","0"),a.line_count=f.height(),a.rotate=!0,f.hover(function(){a.rotate=!1},function(){a.rotate=!0}),x(f,a);else if("paginate"==a.mode){f.css("overflow-y",
"auto");d(c).css("position","relative");d(c).css("height","auto");d(c).css("top","0");for(var u=0,q=function(){f.find(".headline").hide().slice(u*a.numPerPage,(u+1)*a.numPerPage).show()},v=f.find(".headline").length,v=Math.ceil(v/a.numPerPage),y=d('<div class="pager"></div>'),t=0;t<v;t++)d('<span class="page-number"></span>').text(t+1).bind("click",{newPage:t},function(a){u=a.data.newPage;q();d(this).addClass("active").siblings().removeClass("active")}).appendTo(y).addClass("clickable");y.prependTo(f).find("span.page-number:first").addClass("active");
q()}else"ticker"==a.mode&&(d(c).css("position","relative"),d(c).css("height","auto"),d(c).css("top","0"),z(f,a))}function x(f,a){var c=a.container.height();a.line_count+=a.rotate?-2:0;d("p",f).css("top",a.line_count);a.line_count<-c-20&&(a.line_count=f.height());setTimeout(function(){x(f,a)},a.speed)}function z(d,a){d.find(".headline:last").clone().prependTo(d).css("display","none");d.find(".headline:first").fadeIn(1E3).slideDown(500);d.find(".headline:last").fadeOut().remove();setTimeout(function(){z(d,
a)},a.pause)}d.fn.newsviewer=function(f){var a=d.extend({animation:0,animationDuration:500,dataSource:"local",dateFormat:"yy/mm/dd",facebook_access_token:"",facebook_post_types:["status","photo","link"],includeDate:!0,maxItems:10,mode:"default",numPerPage:1,param:null,pause:5E3,sortOrder:0,speed:50,target:"_self",url:null},f);return this.each(function(){d.newsviewer(d(this),a)})};d.newsviewer=function(f,a){f.empty();"scroller"==a.mode&&d("<p></p>").css("position","relative").appendTo(f);a.container=
f;"scroller"==a.mode&&(a.container=d("p",f));if("local"==a.dataSource){if(null!=a.param)for(var c=0;c<a.param.length;c++)k(a.container,a.param[c][0],a.param[c][1],a.param[c][2],a.param[c][3],a);g(f,a)}else if("rss"==a.dataSource){var b=d("<img/>").attr({src:"wb.newsviewer.gif",alt:"Loading. Please wait."}).addClass("news-wait").appendTo(f);d.get(a.url,function(c){b.remove();1==d("feed",c).length?d("feed entry",c).each(function(b,c){if(b>=a.maxItems)return!1;k(a.container,d("link",this).text(),d("title",
this).text(),d("updated",this).text(),d("content",this).text(),a)}):d("rss item",c).each(function(b,c){if(b>=a.maxItems)return!1;k(a.container,d("link",this).text(),d("title",this).text(),d("pubDate",this).text(),d("description",this).text(),a)});g(f,a)})}else"twitter"==a.dataSource?(b=d("<img/>").attr({src:"wb.newsviewer.gif",alt:"Loading. Please wait."}).addClass("news-wait").appendTo(f),d.getJSON(a.url,function(c){b.remove();d.each(c,function(d,b){var c=b.created_at.split(" "),c=Date.parse(c[1]+
" "+c[2]+", "+c[5]+" "+c[3]),e=b.text.replace(/((http|https):\/\/\S+)/g,'<a target="_blank" href="$1">$1</a>'),e=e.replace(/\@(\w+)/g,'<a target="_blank" href="http://twitter.com/$1">@$1</a>');k(a.container,"http://twitter.com/"+a.param,e,c,"",a)});g(f,a)})):"twittersearch"==a.dataSource?(b=d("<img/>").attr({src:"wb.newsviewer.gif",alt:"Loading. Please wait."}).addClass("news-wait").appendTo(f),d.getJSON(a.url,function(c){b.remove();d.each(c.statuses,function(b,d){var c=d.created_at.split(" "),c=
Date.parse(c[1]+" "+c[2]+", "+c[5]+" "+c[3]),e=d.text.replace(/(http:\/\/\S+)/g,'<a target="_blank" href="$1">$1</a>'),e=e.replace(/\@(\w+)/g,'<a target="_blank" href="http://twitter.com/$1">@$1</a>');k(a.container,"http://www.twitter.com/"+d.user.screen_name,'<img style="border-width:0;padding:0px 10px 10px 0px;float:left;" src="'+d.user.profile_image_url+'">'+e,c,"",a)});g(f,a)})):"facebook"==a.dataSource?(b=d("<img/>").attr({src:"wb.newsviewer.gif",alt:"Loading. Please wait."}).addClass("news-wait").appendTo(f),
c="https://graph.facebook.com/"+a.param,c=c+"/feed?access_token="+a.facebook_access_token,c+="&limit=",c+=a.maxItems,c+="&callback=?",d.getJSON(c,function(c){b.remove();d.each(c.data,function(c,b){if(0<=d.inArray(b.type,a.facebook_post_types)){var f=new Date((b.created_time||"").replace(/-/g,"/").replace(/TZ/g," "));(new Date).getTime();f.getTime();var e="",g=a.param;null!=b.from&&(g=b.from.name);void 0!=b.message?e=b.message:void 0!=b.story&&(e=b.story);"link"==b.type&&-1==e.indexOf(b.link)&&(""!=
e&&(e+="<br>"),e+=b.link);e=e.replace(/\b((http|https):\/\/\S+)/g,'<a target="_blank" href="$1">$1</a>');"photo"==b.type&&(e+='<div class="picture">',void 0!=b.link&&(e=e+'<a href="'+b.link,e+='" target="_blank">'),e+='<img src="',e+=b.picture,e+='">',void 0!=b.link&&(e+="</a>"),e+="</div>");k(a.container,"http://www.facebook.com/profile.php?id="+a.param,g,f,e,a)}});g(f,a)})):"flickr"==a.dataSource&&(b=d("<img/>").attr({src:"wb.newsviewer.gif",alt:"Loading. Please wait."}).addClass("news-wait").appendTo(f),
c="http://api.flickr.com/services/feeds/photos_public.gne?format=json&",null!=a.param&&(c+=a.param,c+="&"),c+="jsoncallback=?",d.getJSON(c,function(c){b.remove();d.each(c.items,function(b,c){var f=d("<a></a>").attr("href",c.link).attr("target",a.target).text(c.title),f=d("<h4></h4>").append(f),e=d("<div></div>").addClass("publication-date").text(c.author.split("(")[1].replace(")","")),g=d("<img>").attr("src",c.media.m);d("<div></div>").addClass("headline").append(f,e,g,"").appendTo(a.container);if(b==
a.maxItems)return!1});g(f,a)}))}})(jQuery);